<html>
    <head>
	<link type="text/css" href="/public/css/style.css" rel="stylesheet"/>
	<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    </head>
    <body>
	<p>Whoopie starting again!</p>
	<img src="/public/img/sun.png" width=50px height=50px />
	<button id="getBoards" data-url="/getBoards">getBoards</button>
	<select id="boards">
	</select>
	<select id="cards"></select>
    </body>

    <script type="text/javascript">
     xhr = new XMLHttpRequest();
     xhr.onreadystatechange = function () {
	 var DONE = 4;
	 var OK = 200;
	 if (xhr.readyState === DONE) {
	     if (xhr.status === OK) { 
		 console.log(xhr.responseText);
	     } else {
		 console.log('Error: ' + xhr.status);
	     }
	 }
     };

     var getBoards = document.getElementById('getBoards'),
	 boards = document.getElementById('boards'),
	 cards = document.getElementById('cards'),
	 toReadyStateDescription = function (state) {
	     switch(state) {
		 case 0:
		     return 'UNSENT';
		 case 1:
		     return 'OPENED';
		 case 2:
		     return 'HEADERS_RECEIVED';
		 case 3:
		     return 'LOADING';
		 case 4:
		     return 'DONE';
		 default:
		     return '';
	     }
	 };

     function formatBoards(boardsJ) {
	 var listHTML = "";
	 for (var i = 0; i < boardsJ.length; i++) {
	     var currentBoard = boardsJ[i];
	     listHTML = listHTML + `<option value="${currentBoard.id}">${currentBoard.name}</option>`; 
	 }
	 return listHTML;
     }

     function formatCards(cardsJ) {
	 var listHTML = "";
	 for (var i = 0; i < cardsJ.length; i++) {
	     var currentCard = cardsJ[i];
	     listHTML = listHTML + `<option value="${currentCard.id}">${currentCard.name}</option>`; 
	 }
	 return listHTML;
     }
     
     window.onload = function() {
	 console.log("getBoards pressed");
	 var oReq = new XMLHttpRequest();
	 oReq.onload = function(e) {
	     console.log("request in state onload");
	     
	     boards.innerHTML = formatBoards(JSON.parse(e.target.response).message);
	 };
	 oReq.onreadystatechange = function() {
	     var readyState = toReadyStateDescription(oReq.readyState);
	     console.log("request ready state change: ", readyState);
	 }; 
	     oReq.open('GET', '/getBoards', true);
	     oReq.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
	     oReq.send();
     };

     boards.addEventListener('change', function (e) {
	 console.log("Board selected");
	 var oReq = new XMLHttpRequest();
	 oReq.onload = function(e) {
	     console.log("request in state onload");
	     cards.innerHTML = formatCards(JSON.parse(e.target.response).message);
	 };
	 oReq.onreadystatechange = function() {
	     var readyState = toReadyStateDescription(oReq.readyState);
	     console.log("request ready state change: ", readyState);
	 }; 
	     oReq.open('GET', '/getCards' + '?boardId=' + boards.options[boards.selectedIndex].value, true);
	     oReq.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
	     oReq.send();
     });

    </script>

</html>
